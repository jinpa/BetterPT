---
description: BetterPT project context — goal, tech stack, conventions, constraints. Read before making changes.
alwaysApply: true
---

# BetterPT — project context

Full plan: [prd.md](prd.md).

## Goal

One place to see all current workouts from multiple PTs: log in as the user to MedBridge Go, use one or more access codes (each with a label, e.g. "knee", "elbow"), fetch workout data, and produce a single browsable static site (deployable to GitHub Pages).

## Tech stack

- **Python 3** with venv (`.venv/`). Use `source .venv/bin/activate` or `.venv/bin/python` so Cursor's terminal doesn't rely on system PATH.
- **Dependencies**: `requests`, `python-dotenv`, `beautifulsoup4` (see `requirements.txt`). No Playwright in the current flow.
- **Auth**: Cookie-based session on `https://www.medbridgego.com`. Login form uses `patient[username]`, `patient[password]`. Access code is submitted via `POST /register_token` with form field `token` and hidden `X-CSRF-Token` (from `GET /access_token`).
- **Data source**: Same-origin API `GET /api/v4/plus/episode/episode_with_video_urls` returns JSON with `program` and `program.program_exercises` (name, description HTML, sets, reps, hold, note, etc.). No HTML scraping of the SPA for workout content.
- **Static site**: Plain HTML + CSS generated by a Python script; no front-end framework.

## Conventions and layout

- **Secrets**: `.env` only (gitignored). `MB_USER`, `MB_PASS`, optional `MB_TOKEN`, optional `MB_TOKEN_NAME`. No credentials in repo or in generated files (JWTs/CSRF in saved HTML are redacted where we write to disk).
- **Scripts**: All under `scripts/`. Run from repo root, e.g. `python scripts/export_workout.py` or `.venv/bin/python scripts/export_workout.py`.
- **Outputs**: `scripts/out/` for scrape/export artifacts (HTML dumps, `workout.json`, `workout_<name>.json`). `dist/` for the generated static site (index + program pages + CSS). Both are gitignored.
- **Naming**: Program slugs from program name (lowercase, hyphens). Multiple programs: export once per token with `MB_TOKEN_NAME` set so files are `workout_<name>.json`; build_site discovers all `workout*.json`.

## Key scripts

| Script | Purpose |
|--------|---------|
| `scripts/simple_scrape.py` | POC: login, optional register_token, save HTML to `scripts/out/` (01_sign_in … 05_home_after_token). Redacts JWT/CSRF in saved HTML. |
| `scripts/discover_api.py` | Login, optional token, fetch JS bundle, probe endpoints, call episode_with_video_urls; write `api_discovery.txt` and high-signal summary. |
| `scripts/export_workout.py` | Login, optional token, GET episode_with_video_urls, write minimal JSON to `scripts/out/workout.json` or `workout_<name>.json`. |
| `scripts/build_site.py` | Read all `scripts/out/workout*.json`, generate `dist/index.html`, `dist/<slug>.html`, `dist/style.css`. |

## Constraints

- **Read-only**: We only read MedBridge data; no editing or posting workout content.
- **Manual refresh**: No scheduled or automatic re-fetch; user runs export (and optionally build) when they want an update.
- **v1 scope**: Current assigned workouts only (list + exercise details). No history, progress, or media (videos/PDFs) in v1.
- **Credentials UI**: Out of scope for v1; POC uses .env. Later: simple UI to store username, password, and (token, name) pairs.

## Quick run

```bash
cd /path/to/BetterPT
source .venv/bin/activate
python scripts/export_workout.py
python scripts/build_site.py
open dist/index.html
```

## Deploy

Deploy the contents of `dist/` to GitHub Pages (e.g. push to `gh-pages` branch or use GitHub Actions to build and deploy). No server required.
